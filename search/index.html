<!DOCTYPE html>
<html class="no-js" lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1315&amp;path=livereload" data-no-instant defer></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>站内搜索 - Linguage</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="http://localhost:1315/search/">
  <meta property="og:site_name" content="Linguage">
  <meta property="og:title" content="站内搜索">
  <meta property="og:description" content="在这里搜索站内所有内容：">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">

		
  <meta itemprop="name" content="站内搜索">
  <meta itemprop="description" content="在这里搜索站内所有内容：">
  <meta itemprop="wordCount" content="1">
		
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="站内搜索">
  <meta name="twitter:description" content="在这里搜索站内所有内容：">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo logo--mixed">
		<a class="logo__link" href="/" title="Linguage" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/img/Avatar5518800.png">
				</div><div class="logo__item logo__text">
					<div class="logo__title">Linguage</div>
					<div class="logo__tagline">Stars cannot be surpassed</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">Home</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/">
				
				<span class="menu__text">What&#39;s Old</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/books/">
				
				<span class="menu__text">阅读</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/drafts/parks/">
				
				<span class="menu__text">玩物志</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/labs/">
				
				<span class="menu__text">试验田</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/search/">
				
				<span class="menu__text">搜索</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/static/">
				
				<span class="menu__text">交互式报告</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="https://linguista.bearblog.dev/blog/">
				
				<span class="menu__text">Linguista</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main">
  <div class="primary">
    <div class="content">
      <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
        <header class="page__header">
          <h1 class="page__title" itemprop="headline">站内搜索</h1>
        </header>
        <div class="page__content">
          <p>在这里搜索站内所有内容：</p>

          
          
          <div class="search-container">
            <input type="text" id="search-input" placeholder="输入关键词搜索..." autocomplete="off">
            <button id="search-button">搜索</button>
          </div>
          
          
          <div id="search-results"></div>
          
          
          <div id="search-loading" style="display: none;">
            <p>正在搜索...</p>
          </div>
        </div>
      </article>
    </div>
  </div>
</main>


<script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script>

<script>
let searchIndex;
let searchData;


async function initSearch() {
  try {
    
    const response = await fetch('/search.json');
    if (!response.ok) {
      throw new Error('搜索索引加载失败');
    }
    searchData = await response.json();
    
    
    searchIndex = lunr(function () {
      this.ref('url');
      this.field('title', { boost: 10 });
      this.field('summary', { boost: 5 });
      this.field('content');
      this.field('categories', { boost: 3 });
      this.field('tags', { boost: 3 });
      
      searchData.forEach(function (doc, idx) {
        this.add(doc);
      }, this);
    });
    
    console.log('搜索索引已创建，共索引 ' + searchData.length + ' 篇文章');
  } catch (error) {
    console.error('搜索初始化失败:', error);
    document.getElementById('search-results').innerHTML = '<p>搜索功能暂时不可用，请稍后重试</p>';
  }
}


function performSearch(query) {
  if (!searchData || !query.trim()) {
    document.getElementById('search-results').innerHTML = '';
    return;
  }
  
  document.getElementById('search-loading').style.display = 'block';
  
  setTimeout(() => {
    try {
      let results = [];
      
      
      if (searchIndex) {
        try {
          results = searchIndex.search(query);
        } catch (lunrError) {
          console.warn('Lunr搜索失败，使用备用搜索:', lunrError);
          results = fallbackSearch(query);
        }
      } else {
        
        results = fallbackSearch(query);
      }
      
      displayResults(results, query);
    } catch (error) {
      console.error('搜索执行失败:', error);
      document.getElementById('search-results').innerHTML = '<p>搜索出错，请重试</p>';
    } finally {
      document.getElementById('search-loading').style.display = 'none';
    }
  }, 100);
}


function fallbackSearch(query) {
  const queryLower = query.toLowerCase();
  const queryWords = queryLower.split(/\s+/).filter(word => word.length > 0);
  
  const results = [];
  
  searchData.forEach(page => {
    let score = 0;
    const titleLower = (page.title || '').toLowerCase();
    const summaryLower = (page.summary || '').toLowerCase();
    const contentLower = (page.content || '').toLowerCase();
    const categoriesLower = (page.categories || []).join(' ').toLowerCase();
    const tagsLower = (page.tags || []).join(' ').toLowerCase();
    
    
    queryWords.forEach(word => {
      if (titleLower.includes(word)) score += 10;
      if (summaryLower.includes(word)) score += 5;
      if (contentLower.includes(word)) score += 1;
      if (categoriesLower.includes(word)) score += 3;
      if (tagsLower.includes(word)) score += 3;
    });
    
    
    if (titleLower.includes(queryLower)) score += 20;
    if (summaryLower.includes(queryLower)) score += 10;
    if (contentLower.includes(queryLower)) score += 2;
    
    if (score > 0) {
      results.push({
        ref: page.url,
        score: score
      });
    }
  });
  
  
  return results.sort((a, b) => b.score - a.score);
}


function displayResults(results, query) {
  const resultsContainer = document.getElementById('search-results');
  
  if (results.length === 0) {
    resultsContainer.innerHTML = `<p>没有找到与 "${query}" 相关的内容</p>`;
    return;
  }
  
  let html = `<h3>找到 ${results.length} 个结果：</h3><div class="search-results-list">`;
  
  results.forEach(result => {
    const page = searchData.find(p => p.url === result.ref);
    if (page) {
      const snippet = getSnippet(page.content, query);
      html += `
        <div class="search-result-item">
          <h4><a href="${page.url}">${page.title}</a></h4>
          <div class="search-result-meta">
            <span class="search-result-section">${page.section}</span>
            <span class="search-result-date">${page.date}</span>
          </div>
          <p class="search-result-snippet">${snippet}</p>
          ${page.categories && page.categories.length > 0 ? 
            `<div class="search-result-categories">分类: ${page.categories.join(', ')}</div>` : ''}
        </div>
      `;
    }
  });
  
  html += '</div>';
  resultsContainer.innerHTML = html;
}


function getSnippet(content, query) {
  if (!content) return '';
  
  const words = query.toLowerCase().split(/\s+/);
  const contentLower = content.toLowerCase();
  
  
  let bestPos = 0;
  let bestScore = 0;
  
  words.forEach(word => {
    const pos = contentLower.indexOf(word);
    if (pos !== -1) {
      let score = 1;
      
      score += (content.length - pos) / content.length;
      if (score > bestScore) {
        bestScore = score;
        bestPos = pos;
      }
    }
  });
  
  
  const start = Math.max(0, bestPos - 50);
  const end = Math.min(content.length, bestPos + 150);
  let snippet = content.slice(start, end);
  
  if (start > 0) snippet = '...' + snippet;
  if (end < content.length) snippet = snippet + '...';
  
  
  words.forEach(word => {
    if (word.length > 1) {
      const regex = new RegExp(`(${word})`, 'gi');
      snippet = snippet.replace(regex, '<mark>$1</mark>');
    }
  });
  
  return snippet;
}


document.addEventListener('DOMContentLoaded', function() {
  initSearch();
  
  const searchInput = document.getElementById('search-input');
  const searchButton = document.getElementById('search-button');
  
  
  let searchTimeout;
  searchInput.addEventListener('input', function() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      performSearch(this.value);
    }, 300);
  });
  
  
  searchButton.addEventListener('click', function() {
    performSearch(searchInput.value);
  });
  
  
  searchInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      performSearch(this.value);
    }
  });
  
  
  const urlParams = new URLSearchParams(window.location.search);
  const queryParam = urlParams.get('q') || urlParams.get('query');
  if (queryParam) {
    searchInput.value = queryParam;
    performSearch(queryParam);
  }
});
</script>

			</div>
			<aside class="sidebar">
<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/books/comments/pale-blue-dot-review/">《暗淡蓝点》读后记</a></li>
			<li class="widget__item"><a class="widget__link" href="/books/comments/newton_biography_review/">《牛顿传》读后记</a></li>
			<li class="widget__item"><a class="widget__link" href="/books/comments/comment_hacker_painter/">评论：《黑客与画家》</a></li>
			<li class="widget__item"><a class="widget__link" href="/labs/hello_world_2025/"></a></li>
			<li class="widget__item"><a class="widget__link" href="/labs/test3_link/"></a></li>
		</ul>
	</div>
</div>
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/tags/html/" title="Html">Html</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/reports/" title="Reports">Reports</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/tex/" title="Tex">Tex</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%E4%BC%A0%E8%AE%B0/" title="传记">传记</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%E5%8D%9A%E5%AE%A2/" title="博客">博客</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%E5%8D%A1%E5%B0%94%E8%90%A8%E6%A0%B9/" title="卡尔·萨根">卡尔·萨根</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%E5%AD%A6%E8%80%85/" title="学者">学者</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%E5%B7%A5%E7%A8%8B%E7%A7%91%E5%AD%A6/" title="工程科学">工程科学</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%E6%B5%8B%E8%AF%95/" title="测试">测试</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%E7%89%9B%E9%A1%BF/" title="牛顿">牛顿</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%E7%94%9F%E6%B4%BB%E6%96%B9%E5%BC%8F/" title="生活方式">生活方式</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%E7%A7%91%E5%AD%A6/" title="科学">科学</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%E7%A7%91%E6%99%AE/" title="科普">科普</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" title="计算机科学">计算机科学</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/%E9%BB%91%E5%AE%A2/" title="黑客">黑客</a>
	</div>
</div>
<div class="widget-categories widget">
	<h4 class="widget__title">Categories</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item">
				<a class="widget__link" href="/categories/test/">Test</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/%E6%95%99%E7%A8%8B/">教程</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/%E7%AE%A1%E7%90%86/">管理</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/%E8%AF%84%E8%AE%BA/">评论</a></li>
		</ul>
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2025 Linguage.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="/js/custom.js"></script>

<script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    };
    </script>
    <script id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>


</body>
</html>