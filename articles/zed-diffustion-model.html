<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤äº’å¼æŠ¥å‘Šï¼šæ‰©æ•£è¯­è¨€æ¨¡å‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: A single-page application with a fixed sidebar navigation for easy access to different sections. This structure promotes non-linear exploration of the technical content. Key sections include an interactive comparison of model types, a step-by-step visualization of the diffusion process, a hands-on sampling simulator to mimic the live coding demo, and a chart illustrating the core trade-offs. This is more engaging than a simple text document and allows users to learn by doing. -->
    <!-- Visualization & Content Choices: 
        - Model Comparison (Autoregressive vs. Non-Autoregressive): Goal: Compare. Method: Side-by-side animated cards. Interaction: Scroll-triggered animations. Justification: Clearly highlights fundamental differences in an easy-to-digest visual format.
        - Diffusion Process: Goal: Explain process. Method: JS-controlled step-by-step diagram. Interaction: User clicks a button to advance the animation. Justification: Makes the abstract concepts of noising (forward) and denoising (reverse) concrete and memorable.
        - Quality vs. Speed Trade-off: Goal: Show relationship. Method: Interactive Chart.js bar chart. Interaction: A slider controls the number of generation steps, updating the chart in real-time. Justification: Visually demonstrates the key performance trade-off in an intuitive way.
        - Sampling Simulator: Goal: Engage/Demonstrate. Method: Interactive text area and JS logic. Interaction: User provides masked text and clicks to see the model "think" and fill in the blanks iteratively. Justification: This is the most powerful tool for understanding the model's iterative and self-correcting nature, directly translating a core concept from the report into a hands-on experience.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #f4f5f7;
            color: #1f2937;
        }
        .nav-link {
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        .nav-link.active {
            color: #3b82f6;
            border-left-color: #3b82f6;
            background-color: #eff6ff;
        }
        .nav-link:hover {
            color: #3b82f6;
            background-color: #eff6ff;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .btn {
            background-color: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #2563eb;
        }
        .token {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            margin: 0.25rem;
            border-radius: 0.375rem;
            font-weight: 500;
            border: 1px solid;
            min-width: 60px;
            text-align: center;
        }
        .mask-token {
            background-color: #fee2e2;
            border-color: #fca5a5;
            color: #991b1b;
        }
        .clean-token {
            background-color: #dbeafe;
            border-color: #93c5fd;
            color: #1e40af;
        }
        .generated-token {
            background-color: #d1fae5;
            border-color: #6ee7b7;
            color: #065f46;
        }
        .sim-mask {
            background-color: #e0e7ff;
            color: #4338ca;
            font-weight: bold;
            cursor: pointer;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container { height: 350px; }
        }
    </style>
</head>
<body class="overflow-x-hidden">
    <div class="flex">
        <nav id="sidebar" class="hidden lg:block fixed top-0 left-0 h-screen w-64 bg-white shadow-md p-4">
            <h2 class="text-xl font-bold mb-6 text-gray-800">æ‰©æ•£è¯­è¨€æ¨¡å‹</h2>
            <ul class="space-y-2">
                <li><a href="#intro" class="nav-link block p-2 font-medium text-gray-600 rounded-md">å¼•è¨€</a></li>
                <li><a href="#comparison" class="nav-link block p-2 font-medium text-gray-600 rounded-md">æ ¸å¿ƒå¯¹æ¯”</a></li>
                <li><a href="#how-it-works" class="nav-link block p-2 font-medium text-gray-600 rounded-md">å·¥ä½œåŸç†</a></li>
                <li><a href="#tradeoffs" class="nav-link block p-2 font-medium text-gray-600 rounded-md">å…³é”®æƒè¡¡</a></li>
                <li><a href="#simulation" class="nav-link block p-2 font-medium text-gray-600 rounded-md">é‡‡æ ·æ¨¡æ‹Ÿå™¨</a></li>
                <li><a href="#optimizations" class="nav-link block p-2 font-medium text-gray-600 rounded-md">å…³é”®ä¼˜åŒ–</a></li>
                <li><a href="#advantages" class="nav-link block p-2 font-medium text-gray-600 rounded-md">ä¼˜åŠ¿ä¸æŒ‘æˆ˜</a></li>
            </ul>
        </nav>
        <main class="lg:ml-64 w-full p-4 md:p-8 lg:p-12">
            
            <section id="intro" class="min-h-screen flex flex-col justify-center">
                <div class="max-w-4xl mx-auto">
                    <h1 class="text-4xl md:text-6xl font-bold text-gray-800 mb-4 text-center">æ‰©æ•£è¯­è¨€æ¨¡å‹</h1>
                    <p class="text-lg md:text-xl text-gray-600 mb-8 text-center">ä¸€ç§å…¨æ–°çš„æ–‡æœ¬ç”ŸæˆèŒƒå¼ï¼Œä»å™ªéŸ³ä¸­åˆ›é€ æœ‰åºã€‚æœ¬æŠ¥å‘Šå°†å¸¦æ‚¨äº¤äº’å¼åœ°æ¢ç´¢å…¶æ ¸å¿ƒæ€æƒ³ã€å·¥ä½œåŸç†ä¸ç‹¬ç‰¹ä¼˜åŠ¿ã€‚</p>
                    <div class="relative w-full max-w-2xl mx-auto h-0 pb-[56.25%] mb-8 rounded-lg overflow-hidden shadow-lg">
                        <iframe class="absolute top-0 left-0 w-full h-full" src="https://www.youtube.com/embed/oot4O9wMohw" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                    <div class="text-center text-blue-500 font-bold animate-bounce">
                        &#8595; å‘ä¸‹æ»šåŠ¨å¼€å§‹æ¢ç´¢ &#8595;
                    </div>
                </div>
            </section>

            <section id="comparison" class="py-20">
                <h2 class="text-3xl font-bold text-center mb-4">æ ¸å¿ƒå¯¹æ¯”ï¼šä¸¤ç§ç”ŸæˆèŒƒå¼</h2>
                <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-12">æ‰©æ•£æ¨¡å‹å±äºéè‡ªå›å½’æ¨¡å‹ï¼Œå…¶ç”Ÿæˆæ–¹å¼ä¸æˆ‘ä»¬ç†Ÿæ‚‰çš„GPTç­‰è‡ªå›å½’æ¨¡å‹æœ‰ç€æ ¹æœ¬æ€§çš„ä¸åŒã€‚ç†è§£å®ƒä»¬çš„å·®å¼‚æ˜¯æ¢ç´¢æ‰©æ•£æ¨¡å‹çš„ç¬¬ä¸€æ­¥ã€‚</p>
                <div class="grid md:grid-cols-2 gap-8 max-w-6xl mx-auto">
                    <div class="card p-6">
                        <h3 class="text-2xl font-semibold mb-4 text-center">è‡ªå›å½’æ¨¡å‹ (Autoregressive)</h3>
                        <div class="text-6xl text-center mb-4">â¡ï¸</div>
                        <p class="text-gray-700 mb-4">åƒä¸€ä¸ªä½œå®¶ï¼Œé€å­—é€å¥åœ°å†™ä½œã€‚ä¸¥æ ¼æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºï¼Œä¸€ä¸ªæ¥ä¸€ä¸ªåœ°ç”ŸæˆTokenã€‚</p>
                        <ul class="space-y-2">
                            <li class="flex items-start"><span class="text-green-500 mr-2 font-bold">âœ“</span><span>é€»è¾‘è¿è´¯æ€§å¼ºï¼Œç”Ÿæˆè´¨é‡é«˜ã€‚</span></li>
                            <li class="flex items-start"><span class="text-red-500 mr-2 font-bold">âœ—</span><span>ç”Ÿæˆé€Ÿåº¦æ…¢ï¼Œæ— æ³•å¹¶è¡Œå¤„ç†ã€‚</span></li>
                            <li class="flex items-start"><span class="text-red-500 mr-2 font-bold">âœ—</span><span>ä¸€æ—¦çŠ¯é”™ï¼Œéš¾ä»¥å›å¤´ä¿®æ­£ã€‚</span></li>
                        </ul>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-2xl font-semibold mb-4 text-center">éè‡ªå›å½’æ¨¡å‹ (Non-Autoregressive)</h3>
                        <div class="text-6xl text-center mb-4">ğŸ¨</div>
                        <p class="text-gray-700 mb-4">åƒä¸€ä¸ªç”»å®¶ï¼Œå…ˆå‹¾å‹’è½®å»“å†å¡«å……ç»†èŠ‚ã€‚å¹¶è¡Œåœ°ç”Ÿæˆæ‰€æœ‰Tokenï¼Œå¹¶é€æ­¥ä¼˜åŒ–ã€‚</p>
                        <ul class="space-y-2">
                            <li class="flex items-start"><span class="text-green-500 mr-2 font-bold">âœ“</span><span>ç”Ÿæˆé€Ÿåº¦æå¿«ï¼Œå¯å¹¶è¡ŒåŒ–ã€‚</span></li>
                            <li class="flex items-start"><span class="text-green-500 mr-2 font-bold">âœ“</span><span>èƒ½å¤Ÿè‡ªæˆ‘çº æ­£ï¼Œè¿­ä»£ä¼˜åŒ–ã€‚</span></li>
                            <li class="flex items-start"><span class="text-red-500 mr-2 font-bold">âœ—</span><span>æ—©æœŸæ¨¡å‹è´¨é‡æ§åˆ¶è¾ƒéš¾ã€‚</span></li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="how-it-works" class="py-20 bg-white rounded-2xl">
                <h2 class="text-3xl font-bold text-center mb-4">å·¥ä½œåŸç†ï¼šä»å™ªéŸ³åˆ°æ–‡æœ¬</h2>
                <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-12">æ‰©æ•£æ¨¡å‹å€Ÿé‰´äº†ç‰©ç†å­¦ä¸­çš„æ‰©æ•£è¿‡ç¨‹ï¼Œé€šè¿‡â€œåŠ å™ªâ€å’Œâ€œå»å™ªâ€ä¸¤ä¸ªé˜¶æ®µæ¥ç”Ÿæˆæ–‡æœ¬ã€‚è¿™æ˜¯ä¸€ä¸ªå°†æ— åºå˜ä¸ºæœ‰åºçš„ç¥å¥‡è¿‡ç¨‹ã€‚</p>
                
                <div class="card max-w-4xl mx-auto p-8">
                    <h3 class="text-2xl font-semibold mb-2 text-center">äº¤äº’å¼æ‰©æ•£è¿‡ç¨‹</h3>
                    <p class="text-center text-gray-500 mb-6">ç‚¹å‡»æŒ‰é’®ï¼Œè§‚å¯Ÿæ–‡æœ¬å¦‚ä½•åœ¨â€œåŠ å™ªâ€å’Œâ€œå»å™ªâ€ä¹‹é—´è½¬æ¢ã€‚</p>
                    <div id="diffusion-viz" class="h-48 flex items-center justify-center p-4 bg-gray-50 rounded-lg mb-6">
                    </div>
                    <div class="flex justify-center space-x-4">
                        <button id="forward-btn" class="btn">å¼€å§‹åŠ å™ª (Forward)</button>
                        <button id="reverse-btn" class="btn" disabled>å¼€å§‹å»å™ª (Reverse)</button>
                    </div>
                </div>
            </section>

            <section id="tradeoffs" class="py-20">
                <h2 class="text-3xl font-bold text-center mb-4">å…³é”®æƒè¡¡ï¼šé€Ÿåº¦ vs è´¨é‡</h2>
                <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-12">æ‰©æ•£æ¨¡å‹çš„æ€§èƒ½å¹¶éä¸€æˆä¸å˜ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´â€œå»å™ªæ­¥æ•°â€åœ¨ç”Ÿæˆé€Ÿåº¦å’Œæ–‡æœ¬è´¨é‡ä¹‹é—´åšå‡ºæƒè¡¡ã€‚æ›´å¤šçš„æ­¥æ•°æ„å‘³ç€æ›´ç²¾ç»†çš„æ‰“ç£¨ï¼Œä½†è€—æ—¶ä¹Ÿæ›´é•¿ã€‚</p>
                <div class="card max-w-4xl mx-auto p-8">
                     <div class="chart-container">
                        <canvas id="tradeoffChart"></canvas>
                    </div>
                    <div class="mt-8 px-4">
                        <label for="stepsSlider" class="block text-center font-medium text-gray-700 mb-2">è°ƒæ•´å»å™ªæ­¥æ•°</label>
                        <input id="stepsSlider" type="range" min="1" max="20" value="10" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-sm text-gray-500 mt-2">
                            <span>æ›´å¿«</span>
                            <span id="stepsValue" class="font-bold text-blue-600">10 æ­¥</span>
                             <span>æ›´é«˜è´¨é‡</span>
                        </div>
                    </div>
                </div>
            </section>

            <section id="simulation" class="py-20 bg-gray-50 rounded-2xl">
                <h2 class="text-3xl font-bold text-center mb-4">é‡‡æ ·æ¨¡æ‹Ÿå™¨</h2>
                <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-12">äº²èº«ä½“éªŒæ‰©æ•£æ¨¡å‹çš„ç”Ÿæˆè¿‡ç¨‹ï¼åœ¨ä¸‹é¢çš„æ–‡æœ¬æ¡†ä¸­è¾“å…¥ä¸€ä¸ªå¸¦æœ‰ [MASK] çš„å¥å­ï¼Œç„¶åç‚¹å‡»â€œå¼€å§‹ç”Ÿæˆâ€ï¼Œè§‚å¯Ÿæ¨¡å‹å¦‚ä½•è¿­ä»£åœ°å¡«å……ç©ºç™½å¹¶è¿›è¡Œè‡ªæˆ‘çº æ­£ã€‚</p>
                <div class="card max-w-4xl mx-auto p-8">
                    <div id="simulation-input-area" class="mb-4">
                        <label for="simulation-text" class="block text-lg font-medium text-gray-700 mb-2">è¾“å…¥å¸¦æ©ç çš„æ–‡æœ¬:</label>
                        <div id="simulation-text" contenteditable="true" class="w-full p-3 border border-gray-300 rounded-lg bg-white min-h-[80px]">
                            <span>The capital of </span><span class="token sim-mask">[MASK]</span><span> is </span><span class="token sim-mask">[MASK]</span><span>.</span>
                        </div>
                         <p class="text-xs text-gray-500 mt-2">æç¤º: æ‚¨å¯ä»¥ç›´æ¥ç¼–è¾‘æ–‡æœ¬ï¼Œæˆ–ç‚¹å‡» <span class="token sim-mask">[MASK]</span> æŒ‰é’®æ·»åŠ æ›´å¤šæ©ç ã€‚</p>
                    </div>
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <button id="start-simulation-btn" class="btn">å¼€å§‹ç”Ÿæˆ</button>
                        <div class="flex items-center space-x-2">
                            <label for="sim-steps" class="font-medium">è¿­ä»£æ­¥æ•°:</label>
                            <select id="sim-steps" class="rounded-md border-gray-300">
                                <option>1</option>
                                <option>2</option>
                                <option selected>5</option>
                                <option>10</option>
                            </select>
                        </div>
                    </div>
                    <div id="simulation-output-area" class="mt-6">
                        <h4 class="text-lg font-medium text-gray-700 mb-2">ç”Ÿæˆè¿‡ç¨‹:</h4>
                        <div id="simulation-log" class="p-4 bg-gray-100 rounded-lg min-h-[150px] space-y-2 overflow-y-auto max-h-64 text-sm font-mono">
                           <!-- Simulation logs will appear here -->
                        </div>
                    </div>
                </div>
            </section>

            <section id="optimizations" class="py-20">
                 <h2 class="text-3xl font-bold text-center mb-4">å…³é”®ä¼˜åŒ–ç­–ç•¥</h2>
                <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-12">ä¸ºäº†æé«˜æ•ˆç‡å’Œè´¨é‡ï¼Œç ”ç©¶äººå‘˜æå‡ºäº†å¤šç§ä¼˜åŒ–ç­–ç•¥ï¼Œä½¿æ‰©æ•£æ¨¡å‹åœ¨å®é™…åº”ç”¨ä¸­æ›´å…·ç«äº‰åŠ›ã€‚</p>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
                    <div class="card p-6">
                        <h3 class="text-xl font-semibold mb-2">å—æ‰©æ•£ (Block Diffusion)</h3>
                        <p class="text-gray-600">å°†é•¿åºåˆ—åˆ†æˆå°å—ï¼Œé€å—ç”Ÿæˆã€‚è¿™æå¤§åœ°æé«˜äº†å¤„ç†é•¿æ–‡æœ¬çš„æ•ˆç‡ï¼Œå¹¶ä¸”å¯¹ç¼“å­˜å‹å¥½ï¼Œæ˜¯æé€Ÿçš„å…³é”®æŠ€æœ¯ã€‚</p>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-xl font-semibold mb-2">æ©ç è°ƒåº¦ (Masking Schedules)</h3>
                        <p class="text-gray-600">åŠ¨æ€è°ƒæ•´æ¯ä¸€æ­¥å»æ©ç çš„Tokenæ•°é‡ã€‚åœ¨ç”ŸæˆåˆæœŸï¼ˆå™ªéŸ³å¤šï¼‰å°‘å»ä¸€äº›ï¼ŒåæœŸï¼ˆä¸Šä¸‹æ–‡æ¸…æ™°ï¼‰å¤šå»ä¸€äº›ï¼Œä»¥å¹³è¡¡é€Ÿåº¦ä¸è´¨é‡ã€‚</p>
                    </div>
                     <div class="card p-6">
                        <h3 class="text-xl font-semibold mb-2">ä½œä¸ºè‰ç¨¿æ¨¡å‹ (Draft Model)</h3>
                        <p class="text-gray-600">åœ¨â€œæ¨æµ‹è§£ç â€ä¸­ï¼Œåˆ©ç”¨æ‰©æ•£æ¨¡å‹å¿«é€Ÿç”Ÿæˆä¸€ä¸ªè‰ç¨¿ï¼Œå†ç”±ä¸€ä¸ªæ›´å¼ºçš„æ¨¡å‹è¿›è¡ŒéªŒè¯ï¼Œä»è€Œä¸ºä¼ ç»Ÿè‡ªå›å½’æ¨¡å‹æé€Ÿã€‚</p>
                    </div>
                </div>
            </section>

            <section id="advantages" class="py-20 bg-white rounded-2xl">
                <h2 class="text-3xl font-bold text-center mb-4">ä¼˜åŠ¿ä¸æŒ‘æˆ˜</h2>
                <p class="text-lg text-gray-600 text-center max-w-3xl mx-auto mb-12">æ‰©æ•£æ¨¡å‹å±•ç°äº†å·¨å¤§çš„æ½œåŠ›ï¼Œä½†ä½œä¸ºä¸€é¡¹æ–°å…´æŠ€æœ¯ï¼Œå®ƒä¹Ÿé¢ä¸´ç€è‡ªèº«çš„æŒ‘æˆ˜ã€‚</p>
                <div class="grid md:grid-cols-2 gap-8 max-w-6xl mx-auto">
                    <div>
                        <h3 class="text-2xl font-semibold mb-4 text-green-600">ç‹¬ç‰¹ä¼˜åŠ¿</h3>
                        <ul class="space-y-4">
                            <li class="card p-4"><strong>âš¡ï¸ æé«˜é€Ÿåº¦:</strong> å¹¶è¡Œç”Ÿæˆæœºåˆ¶ä½¿å…¶æ¨ç†é€Ÿåº¦è¿œè¶…è‡ªå›å½’æ¨¡å‹ã€‚</li>
                            <li class="card p-4"><strong>ğŸ”„ è‡ªæˆ‘çº æ­£:</strong> èƒ½å¤Ÿåœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­è¿­ä»£ä¼˜åŒ–ï¼Œä¿®æ­£æ—©æœŸé”™è¯¯ã€‚</li>
                            <li class="card p-4"><strong>ğŸ›ï¸ å¯æ§æ€§å¼º:</strong> å…è®¸æ›´çµæ´»çš„æç¤ºæ–¹å¼å’Œé€šè¿‡å¤–éƒ¨æ¨¡å‹å¼•å¯¼ç”Ÿæˆã€‚</li>
                            <li class="card p-4"><strong>â†”ï¸ åŒå‘ä¸Šä¸‹æ–‡:</strong> åŒæ—¶åˆ©ç”¨å‰åæ–‡ä¿¡æ¯ï¼Œç†è§£æ›´å…¨é¢ã€‚</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-2xl font-semibold mb-4 text-orange-600">å½“å‰æŒ‘æˆ˜</h3>
                        <ul class="space-y-4">
                            <li class="card p-4"><strong>âš–ï¸ é€Ÿåº¦ä¸è´¨é‡çš„æƒè¡¡:</strong> è¿½æ±‚æè‡´é€Ÿåº¦å¯èƒ½ç‰ºç‰²éƒ¨åˆ†è´¨é‡ï¼Œåä¹‹äº¦ç„¶ã€‚</li>
                            <li class="card p-4"><strong>â³ å‘å±•æ—¶é—´å°šçŸ­:</b> ç›¸æ¯”è‡ªå›å½’æ¨¡å‹ï¼Œå…¶ç ”ç©¶å’Œä¼˜åŒ–å†å²è¾ƒçŸ­ï¼Œæ½œåŠ›å°šæœªå®Œå…¨å‘æ˜ã€‚</li>
                        </ul>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            const sidebar = document.getElementById('sidebar');
            const navLinks = sidebar.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('main section');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        navLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href').substring(1) === entry.target.id) {
                                link.classList.add('active');
                            }
                        });
                    }
                });
            }, { rootMargin: '-50% 0px -50% 0px' });

            sections.forEach(section => {
                observer.observe(section);
            });
            
            navLinks.forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });

            const vizContainer = document.getElementById('diffusion-viz');
            const forwardBtn = document.getElementById('forward-btn');
            const reverseBtn = document.getElementById('reverse-btn');
            
            const cleanText = ["The", "cat", "sat", "on", "the", "mat."];
            let currentStep = 0;
            const maxSteps = cleanText.length;

            function renderTokens(tokens, state) {
                vizContainer.innerHTML = '';
                tokens.forEach(token => {
                    const el = document.createElement('div');
                    el.textContent = token;
                    el.classList.add('token', state);
                    vizContainer.appendChild(el);
                });
            }

            renderTokens(cleanText, 'clean-token');

            forwardBtn.addEventListener('click', () => {
                if (currentStep < maxSteps) {
                    currentStep++;
                    const tokens = [...cleanText];
                    for(let i=0; i<currentStep; i++){
                        tokens[i] = '[MASK]';
                    }
                    renderTokens(tokens, 'mask-token');
                    if(currentStep === maxSteps) {
                        forwardBtn.disabled = true;
                        reverseBtn.disabled = false;
                    }
                }
            });

            reverseBtn.addEventListener('click', () => {
                if (currentStep > 0) {
                    currentStep--;
                    const tokens = [...cleanText];
                     for(let i=0; i<currentStep; i++){
                        tokens[i] = '[MASK]';
                    }
                    renderTokens(tokens, 'generated-token');
                     if(currentStep === 0) {
                        reverseBtn.disabled = true;
                        forwardBtn.disabled = false;
                        renderTokens(cleanText, 'clean-token');
                    }
                }
            });

            const tradeoffCtx = document.getElementById('tradeoffChart').getContext('2d');
            const tradeoffChart = new Chart(tradeoffCtx, {
                type: 'bar',
                data: {
                    labels: ['è´¨é‡', 'é€Ÿåº¦'],
                    datasets: [{
                        label: 'æ€§èƒ½æŒ‡æ ‡',
                        data: [80, 40],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.5)',
                            'rgba(16, 185, 129, 0.5)',
                        ],
                        borderColor: [
                            'rgba(59, 130, 246, 1)',
                            'rgba(16, 185, 129, 1)',
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: { max: 100, beginAtZero: true },
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });

            const stepsSlider = document.getElementById('stepsSlider');
            const stepsValue = document.getElementById('stepsValue');

            stepsSlider.addEventListener('input', (e) => {
                const steps = parseInt(e.target.value);
                stepsValue.textContent = `${steps} æ­¥`;
                const quality = 20 + steps * 4;
                const speed = 100 - steps * 3;
                tradeoffChart.data.datasets[0].data = [quality, speed];
                tradeoffChart.update();
            });


            const simTextArea = document.getElementById('simulation-text');
            const startSimBtn = document.getElementById('start-simulation-btn');
            const simLog = document.getElementById('simulation-log');
            
            simTextArea.addEventListener('click', (e) => {
                if(e.target.classList.contains('sim-mask')) {
                    const textNode = document.createTextNode(e.target.textContent);
                    e.target.parentNode.replaceChild(textNode, e.target);
                }
            });


            const vocabulary = {
                "capital": ["london", "paris", "delhi", "tokyo", "beijing"],
                "country": ["france", "india", "japan", "china", "uk"],
                "is": ["is", "was"],
                "of": ["of", "for"]
            };

            const grammar = {
                "the capital of [MASK] is [MASK].": (m1, m2) => {
                    const pairs = {"france": "paris", "india": "delhi", "uk": "london", "japan": "tokyo", "china": "beijing"};
                    if (vocabulary.country.includes(m1) && pairs[m1] === m2) return 10;
                    if (vocabulary.country.includes(m1) || vocabulary.capital.includes(m2)) return 3;
                    return 1;
                }
            };

            startSimBtn.addEventListener('click', () => {
                simLog.innerHTML = '';
                const initialHTML = simTextArea.innerHTML;
                let tokens = Array.from(simTextArea.childNodes).map(node => {
                    if (node.nodeType === 3) return node.textContent.trim().split(' ').filter(Boolean);
                    if (node.nodeType === 1 && node.classList.contains('sim-mask')) return '[MASK]';
                    return node.textContent.trim().split(' ').filter(Boolean);
                }).flat();
                
                const totalSteps = parseInt(document.getElementById('sim-steps').value);
                let currentStep = 0;

                function logStep(step, message, currentTokens) {
                    const p = document.createElement('p');
                    p.innerHTML = `<span class="font-bold text-blue-600">Step ${step}:</span> ${message} -> <span class="text-gray-800">${currentTokens.join(' ')}</span>`;
                    simLog.appendChild(p);
                    simLog.scrollTop = simLog.scrollHeight;
                }
                
                function runStep() {
                    if (currentStep >= totalSteps || !tokens.includes('[MASK]')) {
                         logStep(currentStep + 1, "<strong>å®Œæˆ</strong>", tokens);
                         return;
                    }
                    currentStep++;
                    
                    let maskIndices = [];
                    tokens.forEach((t, i) => { if(t === '[MASK]') maskIndices.push(i) });
                    
                    if(maskIndices.length === 0) {
                        logStep(currentStep, "<strong>å®Œæˆ</strong>", tokens);
                        return;
                    }

                    let bestCandidate = null;
                    let maxConfidence = -1;
                    
                    const targetMaskIndex = maskIndices[Math.floor(Math.random() * maskIndices.length)];

                    let possibleWords = [...vocabulary.capital, ...vocabulary.country, ...vocabulary.is, ...vocabulary.of];
                    possibleWords.forEach(word => {
                        let tempTokens = [...tokens];
                        tempTokens[targetMaskIndex] = word;
                        
                        let confidence = Math.random(); 
                        if (tempTokens.join(' ').toLowerCase().includes("the capital of") && tempTokens.filter(t => t !== '[MASK]').length > 3){
                             const m = tempTokens.join(' ').toLowerCase().match(/the capital of (.*) is (.*)\./);
                             if (m) {
                                confidence += grammar["the capital of [MASK] is [MASK]."](m[1], m[2]);
                             }
                        }

                        if (confidence > maxConfidence) {
                            maxConfidence = confidence;
                            bestCandidate = word;
                        }
                    });

                    tokens[targetMaskIndex] = `<span class="generated-token">${bestCandidate}</span>`;
                    logStep(currentStep, `å¡«å……æœ€å¯èƒ½çš„è¯...`, tokens);
                    tokens[targetMaskIndex] = bestCandidate;

                    setTimeout(runStep, 1000);
                }
                logStep(0, "å¼€å§‹...", tokens);
                runStep();
            });

        });
    </script>
</body>
</html>
