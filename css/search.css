/* 顶部搜索栏与弹出结果样式 */
.site-search { position: relative; flex: 1 1 auto; max-width: none; margin: 0 16px; }
.site-search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); width: 18px; height: 18px; color: var(--muted, #6B665F); pointer-events: none; display: inline-flex; align-items: center; justify-content: center; line-height: 0; }
.site-search-input {
  width: 100%; height: 38px; padding: 6px 12px 6px 36px;
  border: 1px solid var(--border, #E6E3DC); border-radius: 20px; outline: none;
  color: var(--text, #2E2A25); background: var(--surface, #FCFBF9);
  transition: box-shadow .2s ease, border-color .2s ease, background .2s ease;
}
.site-search-input:hover{ border-color: var(--border, #E6E3DC); box-shadow: 0 2px 10px rgba(0,0,0,0.04); }
.site-search-input::placeholder{ color: var(--muted, #6B665F); }
.site-search-input:focus{ box-shadow: 0 0 0 3px rgba(15,109,220,0.08), 0 8px 20px rgba(0,0,0,0.06); border-color: var(--accent-2, #0F6DDC); background: var(--surface, #FCFBF9); }

  .site-search-popover {
    position: absolute; top: calc(100% + 8px); left: 0; right: 0; z-index: 1000;
    background: var(--surface, #FCFBF9);
    border: 1.5px solid #CFC8BD; /* 更强分隔，避免与正文混淆 */
    border-radius: 12px;
    box-shadow: 0 10px 28px rgba(0,0,0,0.10); /* 稍加强，形成浮层层次感 */
    max-height: 70vh;
    overflow: auto;
  }
.search-popover-header { padding: 10px 12px; font-size: 12px; color: var(--muted, #6B665F); border-bottom: 1px solid var(--border, #E6E3DC); }
.search-results { padding: 6px; }
.search-item { display: block; padding: 10px 12px; border-radius: 10px; color: inherit; text-decoration: none; }
.search-item:hover, .search-item.is-active { background: rgba(15,109,220,0.08); }
.search-more{ padding: 8px 12px 12px; display: flex; justify-content: center; }
.search-more-btn{
  appearance: none;
  background: rgba(0,0,0,0.02);
  border: 1px solid var(--border, #E6E3DC);
  color: var(--text, #2E2A25);
  border-radius: 999px;
  padding: 8px 14px;
  font-size: 13px;
  cursor: pointer;
  line-height: 1;
}
.search-more-btn:hover{ background: rgba(0,0,0,0.04); }
.search-more-btn:focus-visible{ outline: 2px solid rgba(15,109,220,0.35); outline-offset: 1px; }
.site-search-popover .search-mode-head{
  display:flex; align-items:center; flex-wrap:wrap; gap:10px;
  padding: 10px 12px; border-bottom: 1px solid var(--border, #E6E3DC);
  margin: 0; background: var(--surface, #FCFBF9); /* 改为不透明，避免滚动时互相干涉 */
  border-top-left-radius: 12px; border-top-right-radius: 12px;
  box-shadow: 0 1px 0 rgba(0,0,0,0.06); /* 轻分隔线，增强层次 */
  position: sticky; top: 0; z-index: 1;
}
.site-search-popover .search-mode-label{ font-size: 12px; color: var(--muted, #6B665F); font-weight: 600; letter-spacing: .06em; }
.site-search-popover .search-mode-tabs{ display:flex; gap:8px; margin-left:auto; flex-wrap:wrap; }
.mode-tab{ appearance:none; background: rgba(0,0,0,0.02); border:1px solid var(--border, #E6E3DC); color: var(--text, #2E2A25); border-radius: 999px; padding: 5px 10px; font-size: 12px; cursor: pointer; line-height: 1; }
.mode-tab:hover{ background: rgba(0,0,0,0.04); }
.mode-tab.is-active{ border-color: var(--accent-2, #0F6DDC); background: rgba(15,109,220,0.12); }
.mode-tab:focus-visible{ outline: 2px solid rgba(15,109,220,0.35); outline-offset: 1px; }
/* 更友好的高亮 */
.search-item mark{ background: rgba(15,109,220,0.16); color: inherit; border-radius: 3px; padding: 0 .12em; }
/* 仅显示标题与正文摘要：隐藏元信息（section/date 等） */
.site-search-popover .search-item-meta{ display: none !important; }

/* 深色模式下：使用更适合的暗黄色高亮，保持可读性 */
:root[data-theme="dark"] .search-item mark{ background: rgba(249,214,123,0.32); color: var(--text, #f5f1e6); }
@media (prefers-color-scheme: dark){
  :root:not([data-theme]) .search-item mark{ background: rgba(249,214,123,0.32); color: var(--text, #f5f1e6); }
}
  /* 本页搜索：仅显示所在行（单行省略） */
  .search-item-line {
    font-size: 13px;
    display: -webkit-box;
    line-clamp: 1;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: normal; /* 允许换行，由 line-clamp 限制为单行 */
  }
  /* 站内搜索摘要：桌面两行，移动端三行 */
  .search-item-snippet{
    font-size: 13px;
    color: var(--muted, #6B665F);
    display: -webkit-box;
    line-clamp: 2;
    -webkit-line-clamp: 2; /* 桌面默认两行 */
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: normal;
  }
  @media (max-width: 900px){
    .search-item-snippet{ line-clamp: 3; -webkit-line-clamp: 3; }
  }
  /* 快捷入口与模式切换 */
.search-quick-header { padding: 10px 12px; font-size: 12px; color: var(--muted, #6B665F); border-bottom: 1px solid var(--border, #E6E3DC); }
.actions .posts-btn{ order: 2; }
.actions .theme-toggle-btn{ order: 3; }
/* 桌面端：恢复 actions 弹性布局，使搜索占据剩余空间并在视觉上居中 */
.header-inner .actions{ display:flex; align-items:center; gap:10px; flex: 1 1 auto; min-width:0; margin-left: 0 !important; }
.actions .site-search{ order: 1; flex: 1 1 600px; width: auto; max-width: 600px; min-width: 320px; margin: 0 clamp(8px, 2vw, 16px); }

/* 新移动端交互：默认仅图标，点击展开全宽覆盖 */
.search-toggle-btn{ display: none; }
.mobile-search-back{ display: none; }

@media (max-width: 900px){
  /* Header 行为：右侧保留 Posts/主题与搜索图标，搜索输入默认隐藏 */
  .site-header .actions{ display: inline-flex; align-items:center; gap:10px; width: 100%; }
  /* 右侧按钮组：搜索按钮在左，Posts 与 主题在右；整体靠右对齐 */
  .search-toggle-btn{ order: 1; display: inline-flex; align-items:center; justify-content:center; min-width: 36px; height: 34px; padding: 6px 8px; margin-left: auto; }
  .actions .posts-btn{ order: 2; }
  .actions .theme-toggle-btn{ order: 3; }
  .actions .site-search{ display: none; }

  /* 展开状态：贯穿 header 的输入，左侧返回按钮 */
  body.mobile-searching .actions .site-search{
    display: block;
    position: fixed; left: 12px; right: 12px; top: 8px; z-index: 500; margin: 0;
  }
  body.mobile-searching .site-search-input{
    height: 40px; border-radius: 20px; padding-left: 48px; padding-right: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  }
  body.mobile-searching .mobile-search-back{ display: inline-flex; position: absolute; left: 6px; top: 50%; transform: translateY(-50%); width: 36px; height: 36px; align-items:center; justify-content:center; border: none; border-radius: 50%; background: transparent; box-shadow: none; }
  body.mobile-searching .site-search-icon{ display: none; }
  /* 展开时隐藏右侧按钮（搜索图标/Posts/主题）避免拥挤 */
  body.mobile-searching .actions .search-toggle-btn,
  body.mobile-searching .actions .posts-btn,
  body.mobile-searching .actions .theme-toggle-btn{ display: none !important; }
  /* 弹层仍跟随输入框下方 */
  body.mobile-searching .site-search-popover{ top: calc(100% + 8px); max-height: 68vh; }
}

/* 本页搜索：命中高亮动画 */
.search-hit-flash{ animation: searchHitFlash 1.2s ease-out 1; outline: 2px solid var(--accent-2, #0F6DDC); outline-offset: 2px; scroll-margin-top: calc(var(--theme-header-height, 56px) + 8px); }
@keyframes searchHitFlash{
  0%{ background-color: rgba(15,109,220,0.18); }
  60%{ background-color: rgba(15,109,220,0.08); }
  100%{ background-color: transparent; }
}
